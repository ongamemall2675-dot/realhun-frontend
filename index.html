<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜œí™”72 ìŠ¤ë§ˆíŠ¸ ì˜¤í”¼ìŠ¤</title>
    <link rel="stylesheet" href="/assets/css/common.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Gridstack.js -->
    <link href="https://cdn.jsdelivr.net/npm/gridstack@10.0.0/dist/gridstack.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/gridstack@10.0.0/dist/gridstack-extra.min.css" rel="stylesheet">
    <style>
        .grid-stack {
            background: transparent;
        }

        .grid-stack-item-content {
            background: var(--bg-card);
            border-radius: 0.75rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }

        .grid-stack-item-content:hover {
            box-shadow: var(--shadow-md);
        }

        .widget-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.875rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            background: #f8fafc;
            cursor: move;
        }

        .widget-header h3 {
            font-size: 0.9rem;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .widget-header .widget-actions {
            display: flex;
            gap: 0.5rem;
        }

        .widget-header .widget-actions button {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
        }

        .widget-header .widget-actions button:hover {
            background: #e2e8f0;
            color: var(--text-primary);
        }

        .widget-body {
            padding: 1rem;
            height: calc(100% - 52px);
            overflow-y: auto;
        }

        .quick-links {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .quick-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem 0.5rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            text-decoration: none;
            color: inherit;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .quick-link:hover {
            background: #eef2ff;
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .quick-link i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .quick-link span {
            font-size: 0.8rem;
            font-weight: 500;
        }

        .ai-app-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .ai-app-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            text-decoration: none;
            color: inherit;
            transition: all 0.2s;
        }

        .ai-app-item:hover {
            background: #eef2ff;
            transform: translateX(4px);
        }

        .ai-app-item.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .ai-app-icon {
            width: 40px;
            height: 40px;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .ai-app-info h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin: 0 0 0.25rem;
        }

        .ai-app-info p {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin: 0;
        }

        .server-status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .server-card {
            padding: 0.75rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            text-align: center;
        }

        .server-card .server-name {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .server-card .server-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .server-card .server-status.online {
            color: var(--secondary);
        }

        .server-card .server-status.offline {
            color: var(--danger);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .stat-value {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.5rem 0;
            font-size: 0.85rem;
        }

        .activity-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-time {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .edit-mode .grid-stack-item-content {
            border: 2px dashed var(--primary);
        }

        .edit-mode .widget-header {
            background: #dbeafe;
        }

        .dashboard-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .dashboard-controls .btn-group {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .datetime-widget {
            text-align: center;
            padding: 1rem;
        }

        .datetime-widget .time {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .datetime-widget .date {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .datetime-widget .greeting {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-top: 0.75rem;
        }
    </style>
</head>

<body>
    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar-logo">ğŸ¢ í˜œí™”72</div>
            <nav>
                <ul class="sidebar-nav">
                    <li><a href="/" class="active"><i class="fas fa-th-large"></i> ëŒ€ì‹œë³´ë“œ</a></li>
                    <div class="nav-section">AI ì½˜í…ì¸ </div>
                    <li><a href="/apps/economy_script.html"><i class="fas fa-chart-line"></i> ê²½ì œí•™ 1íƒ€ ê°•ì‚¬</a></li>
                    <li><a href="/apps/senior_health.html"><i class="fas fa-heartbeat"></i> ì‹œë‹ˆì–´ ê±´ê°•</a></li>
                    <li><a href="/apps/story_teller.html"><i class="fas fa-book"></i> ìŠ¤í† ë¦¬í…”ëŸ¬</a></li>
                    <div class="nav-section">ë¶€ë™ì‚°</div>
                    <li><a href="/realestate/"><i class="fas fa-building"></i> ë§¤ë¬¼ ëª©ë¡</a></li>
                    <li><a href="/realestate/admin.html"><i class="fas fa-edit"></i> ë§¤ë¬¼ ê´€ë¦¬</a></li>
                    <div class="nav-section">ê´€ë¦¬</div>
                    <li><a href="/admin/n8n-control.html"><i class="fas fa-cogs"></i> n8n ì œì–´</a></li>
                    <li><a href="/admin/rag.html"><i class="fas fa-database"></i> RAG ê´€ë¦¬</a></li>
                    <li><a href="/admin/server-status.html"><i class="fas fa-server"></i> ì„œë²„ ìƒíƒœ</a></li>
                </ul>
            </nav>
            <div style="margin-top: auto; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1);">
                <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.5rem;">ì„œë²„ ìƒíƒœ</div>
                <div style="display: flex; gap: 1rem; font-size: 0.8rem;">
                    <span><span class="status-indicator status-online" id="status-n8n"></span> n8n</span>
                    <span><span class="status-indicator status-online" id="status-rag"></span> RAG</span>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="dashboard-controls">
                <div>
                    <h1 style="font-size: 1.5rem; font-weight: 700; margin: 0;">ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”, ì‚¬ì¥ë‹˜!</h1>
                    <p style="color: var(--text-muted); margin: 0.25rem 0 0; font-size: 0.9rem;">ì˜¤ëŠ˜ë„ ìµœê³ ì˜ ì¤‘ê°œë¥¼ ì‹œì‘í•´ë³¼ê¹Œìš”?</p>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary btn-icon" id="btn-edit" title="ìœ„ì ¯ í¸ì§‘">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-secondary btn-icon" id="btn-reset" title="ë ˆì´ì•„ì›ƒ ì´ˆê¸°í™”">
                        <i class="fas fa-undo"></i>
                    </button>
                    <button class="btn btn-primary btn-icon" id="btn-save" title="ë ˆì´ì•„ì›ƒ ì €ì¥" style="display:none;">
                        <i class="fas fa-save"></i>
                    </button>
                </div>
            </div>

            <div class="grid-stack" id="dashboard-grid"></div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/gridstack@10.0.0/dist/gridstack-all.min.js"></script>
    <script src="/assets/js/api.js"></script>
    <script>
        const widgetTemplates = {
            datetime: {
                id: 'datetime', title: 'ì‹œê°„ & ì¸ì‚¬', icon: 'fa-clock', color: '#6366f1',
                x: 0, y: 0, w: 4, h: 2,
                content: `<div class="datetime-widget">
                    <div class="time" id="current-time">--:--</div>
                    <div class="date" id="current-date">----ë…„ --ì›” --ì¼</div>
                    <div class="greeting" id="greeting">ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!</div>
                </div>`
            },
            quickLinks: {
                id: 'quickLinks', title: 'ë¹ ë¥¸ ì‹¤í–‰', icon: 'fa-bolt', color: '#f59e0b',
                x: 4, y: 0, w: 4, h: 2,
                content: `<div class="quick-links">
                    <a href="https://vrew.ai" target="_blank" class="quick-link">
                        <i class="fas fa-video" style="color: #6366f1;"></i><span>Vrew</span>
                    </a>
                    <a href="https://new.land.naver.com" target="_blank" class="quick-link">
                        <i class="fas fa-map-marked-alt" style="color: #22c55e;"></i><span>ë„¤ì´ë²„ ë¶€ë™ì‚°</span>
                    </a>
                    <a href="https://disco.re" target="_blank" class="quick-link">
                        <i class="fas fa-building" style="color: #3b82f6;"></i><span>ë””ìŠ¤ì½”</span>
                    </a>
                    <a href="https://chatgpt.com" target="_blank" class="quick-link">
                        <i class="fas fa-robot" style="color: #10b981;"></i><span>ChatGPT</span>
                    </a>
                </div>`
            },
            serverStatus: {
                id: 'serverStatus', title: 'ì„œë²„ ìƒíƒœ', icon: 'fa-server', color: '#ef4444',
                x: 8, y: 0, w: 4, h: 2,
                content: `<div class="server-status-grid">
                    <div class="server-card">
                        <div class="server-name">n8n ì„œë²„</div>
                        <div class="server-status online" id="server-n8n"><i class="fas fa-circle"></i> ì •ìƒ</div>
                    </div>
                    <div class="server-card">
                        <div class="server-name">RAG ì„œë²„</div>
                        <div class="server-status online" id="server-rag"><i class="fas fa-circle"></i> ì •ìƒ</div>
                    </div>
                    <div class="server-card">
                        <div class="server-name">DB ì„œë²„</div>
                        <div class="server-status online" id="server-db"><i class="fas fa-circle"></i> ì •ìƒ</div>
                    </div>
                    <div class="server-card">
                        <div class="server-name">ì›¹ ì„œë²„</div>
                        <div class="server-status online" id="server-web"><i class="fas fa-circle"></i> ì •ìƒ</div>
                    </div>
                </div>`
            },
            aiApps: {
                id: 'aiApps', title: 'AI ì½˜í…ì¸  ì œì‘ì†Œ', icon: 'fa-magic', color: '#3b82f6',
                x: 0, y: 2, w: 6, h: 3,
                content: `<div class="ai-app-list">
                    <a href="/apps/economy_script.html" class="ai-app-item">
                        <div class="ai-app-icon" style="background: #dbeafe; color: #3b82f6;"><i class="fas fa-chart-line"></i></div>
                        <div class="ai-app-info"><h4>ê²½ì œí•™ 1íƒ€ ê°•ì‚¬</h4><p>ì–´ë ¤ìš´ ê²½ì œ ë‰´ìŠ¤ë¥¼ ì‰½ê²Œ ì„¤ëª…</p></div>
                        <span class="badge badge-success"><i class="fas fa-check"></i></span>
                    </a>
                    <a href="/apps/senior_health.html" class="ai-app-item disabled">
                        <div class="ai-app-icon" style="background: #fce7f3; color: #ec4899;"><i class="fas fa-heartbeat"></i></div>
                        <div class="ai-app-info"><h4>ì‹œë‹ˆì–´ ê±´ê°•</h4><p>60ëŒ€ ê±´ê°• ì •ë³´ ì½˜í…ì¸ </p></div>
                        <span class="badge">ì¤€ë¹„ì¤‘</span>
                    </a>
                    <a href="/apps/story_teller.html" class="ai-app-item disabled">
                        <div class="ai-app-icon" style="background: #fef3c7; color: #f59e0b;"><i class="fas fa-book"></i></div>
                        <div class="ai-app-info"><h4>ìŠ¤í† ë¦¬í…”ëŸ¬</h4><p>íƒˆë¶ë¯¼ ìŠ¤í† ë¦¬ ë¡±í¼ ì½˜í…ì¸ </p></div>
                        <span class="badge">ì¤€ë¹„ì¤‘</span>
                    </a>
                </div>`
            },
            realEstate: {
                id: 'realEstate', title: 'ë¶€ë™ì‚° í˜„í™©', icon: 'fa-home', color: '#10b981',
                x: 6, y: 2, w: 3, h: 3,
                content: `<div>
                    <div class="stat-row"><span class="stat-label">ë“±ë¡ ë§¤ë¬¼</span><span class="stat-value" id="stat-total">-</span></div>
                    <div class="stat-row"><span class="stat-label">ì´ë²ˆ ì£¼ ì‹ ê·œ</span><span class="stat-value" id="stat-new" style="color: var(--secondary);">-</span></div>
                    <div class="stat-row"><span class="stat-label">ì´ë²ˆ ë‹¬ ê³„ì•½</span><span class="stat-value" id="stat-contract" style="color: var(--primary);">-</span></div>
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        <a href="/realestate/" class="btn btn-secondary" style="flex:1; font-size: 0.8rem;"><i class="fas fa-list"></i> ëª©ë¡</a>
                        <a href="/realestate/admin.html" class="btn btn-primary" style="flex:1; font-size: 0.8rem;"><i class="fas fa-plus"></i> ë“±ë¡</a>
                    </div>
                </div>`
            },
            activity: {
                id: 'activity', title: 'ìµœê·¼ í™œë™', icon: 'fa-history', color: '#8b5cf6',
                x: 9, y: 2, w: 3, h: 3,
                content: `<div class="activity-list" id="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon" style="background: #dbeafe; color: #3b82f6;"><i class="fas fa-file-alt"></i></div>
                        <div class="activity-content"><div>ê²½ì œ ëŒ€ë³¸ ìƒì„± ì™„ë£Œ</div><div class="activity-time">5ë¶„ ì „</div></div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon" style="background: #dcfce7; color: #22c55e;"><i class="fas fa-home"></i></div>
                        <div class="activity-content"><div>ìƒˆ ë§¤ë¬¼ ë“±ë¡</div><div class="activity-time">1ì‹œê°„ ì „</div></div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon" style="background: #fef3c7; color: #f59e0b;"><i class="fas fa-cog"></i></div>
                        <div class="activity-content"><div>ì›Œí¬í”Œë¡œìš° ì‹¤í–‰</div><div class="activity-time">2ì‹œê°„ ì „</div></div>
                    </div>
                </div>`
            }
        };

        function createWidgetHTML(widget) {
            return `<div class="widget-header" data-gs-drag-handle>
                <h3><i class="fas ${widget.icon}" style="color: ${widget.color};"></i> ${widget.title}</h3>
                <div class="widget-actions">
                    <button onclick="refreshWidget('${widget.id}')" title="ìƒˆë¡œê³ ì¹¨"><i class="fas fa-sync-alt"></i></button>
                </div>
            </div>
            <div class="widget-body">${widget.content}</div>`;
        }

        let grid;
        let isEditMode = false;

        function initDashboard() {
            const savedLayout = localStorage.getItem('dashboardLayout');
            let items;
            if (savedLayout) {
                items = JSON.parse(savedLayout);
            } else {
                items = Object.values(widgetTemplates).map(w => ({
                    id: w.id, x: w.x, y: w.y, w: w.w, h: w.h,
                    content: createWidgetHTML(w)
                }));
            }

            grid = GridStack.init({
                column: 12,
                cellHeight: 80,
                margin: 10,
                float: true,
                draggable: { handle: '.widget-header' },
                resizable: { handles: 'se, sw' },
                disableDrag: true,
                disableResize: true
            });

            grid.load(items);
            grid.on('change', saveLayout);
        }

        function saveLayout() {
            const items = grid.save(false);
            localStorage.setItem('dashboardLayout', JSON.stringify(items));
        }

        function toggleEditMode() {
            isEditMode = !isEditMode;
            const container = document.querySelector('.main-content');
            const editBtn = document.getElementById('btn-edit');
            const saveBtn = document.getElementById('btn-save');

            if (isEditMode) {
                container.classList.add('edit-mode');
                grid.enableMove(true);
                grid.enableResize(true);
                editBtn.innerHTML = '<i class="fas fa-times"></i>';
                editBtn.classList.replace('btn-secondary', 'btn-danger');
                saveBtn.style.display = 'flex';
            } else {
                container.classList.remove('edit-mode');
                grid.enableMove(false);
                grid.enableResize(false);
                editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                editBtn.classList.replace('btn-danger', 'btn-secondary');
                saveBtn.style.display = 'none';
                saveLayout();
            }
        }

        function resetLayout() {
            if (confirm('ë ˆì´ì•„ì›ƒì„ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('dashboardLayout');
                location.reload();
            }
        }

        function refreshWidget(widgetId) { console.log('Refreshing:', widgetId); }

        function updateDateTime() {
            const now = new Date();
            const timeEl = document.getElementById('current-time');
            const dateEl = document.getElementById('current-date');
            const greetingEl = document.getElementById('greeting');

            if (timeEl) timeEl.textContent = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            if (dateEl) dateEl.textContent = now.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
            if (greetingEl) {
                const hour = now.getHours();
                let greeting = hour < 6 ? 'ëŠ¦ì€ ë°¤ê¹Œì§€ ìˆ˜ê³ í•˜ì„¸ìš”! ğŸŒ™' : hour < 12 ? 'ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”! â˜€ï¸' : hour < 18 ? 'ì˜¤í›„ë„ í™”ì´íŒ…! ğŸ’ª' : 'ì €ë… ì‹œê°„ì´ì—ìš”! ğŸŒ†';
                greetingEl.textContent = greeting;
            }
        }

        async function checkServers() {
            const servers = [
                { id: 'status-n8n', elId: 'server-n8n', url: 'https://n8n.hyehwa72.org/healthz', cors: true },
                { id: 'status-rag', elId: 'server-rag', url: 'https://rag.hyehwa72.org/health', cors: false }
            ];
            for (const server of servers) {
                try {
                    const opts = server.cors ? { mode: 'no-cors' } : {};
                    await fetch(server.url, opts);
                    updateServerStatus(server.id, true);
                    updateServerStatus(server.elId, true);
                } catch {
                    updateServerStatus(server.id, false);
                    updateServerStatus(server.elId, false);
                }
            }
        }

        function updateServerStatus(elId, isOnline) {
            const el = document.getElementById(elId);
            if (!el) return;
            if (el.classList.contains('status-indicator')) {
                el.className = `status-indicator ${isOnline ? 'status-online' : 'status-offline'}`;
            } else {
                el.className = `server-status ${isOnline ? 'online' : 'offline'}`;
                el.innerHTML = `<i class="fas fa-circle"></i> ${isOnline ? 'ì •ìƒ' : 'ì˜¤ë¥˜'}`;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initDashboard();
            updateDateTime();
            setInterval(updateDateTime, 1000);
            checkServers();
            setInterval(checkServers, 60000);

            document.getElementById('btn-edit').addEventListener('click', toggleEditMode);
            document.getElementById('btn-reset').addEventListener('click', resetLayout);
            document.getElementById('btn-save').addEventListener('click', () => {
                saveLayout();
                toggleEditMode();
                alert('ë ˆì´ì•„ì›ƒì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        });
    </script>
</body>

</html>